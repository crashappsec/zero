{
  "metadata": {
    "version": "1.0.0",
    "updated": "2025-01-15",
    "category": "supply-chain/ecosystems",
    "description": "npm ecosystem patterns for package analysis and security assessment"
  },
  "ecosystem": {
    "name": "npm",
    "registry": "https://registry.npmjs.org",
    "package_managers": ["npm", "yarn", "pnpm", "bun"],
    "manifest_files": ["package.json"],
    "lockfiles": ["package-lock.json", "yarn.lock", "pnpm-lock.yaml", "bun.lockb"]
  },
  "api_endpoints": {
    "package_info": "https://registry.npmjs.org/{package}",
    "package_version": "https://registry.npmjs.org/{package}/{version}",
    "search": "https://registry.npmjs.org/-/v1/search?text={query}",
    "downloads": "https://api.npmjs.org/downloads/point/{period}/{package}",
    "security_advisories": "https://registry.npmjs.org/-/npm/v1/security/advisories/bulk"
  },
  "package_name_validation": {
    "max_length": 214,
    "pattern": "^(?:(?:@[a-z0-9-~][a-z0-9-._~]*/)?[a-z0-9-~][a-z0-9-._~]*)$",
    "reserved_names": ["node_modules", "favicon.ico"],
    "scoped_pattern": "^@[a-z0-9-~][a-z0-9-._~]*/[a-z0-9-~][a-z0-9-._~]*$"
  },
  "security_indicators": {
    "deprecated": {
      "field": "deprecated",
      "severity": "medium",
      "description": "Package has been marked deprecated by maintainer"
    },
    "unpublished": {
      "indicator": "404 response",
      "severity": "high",
      "description": "Package was unpublished, possible supply chain attack"
    },
    "ownership_change": {
      "field": "maintainers history change",
      "severity": "medium",
      "description": "Package ownership changed recently"
    },
    "install_scripts": {
      "fields": ["preinstall", "install", "postinstall"],
      "severity": "info",
      "description": "Package runs scripts during installation"
    }
  },
  "health_signals": {
    "positive": [
      {
        "signal": "types_included",
        "check": "types field in package.json or @types/* dependency",
        "weight": 0.1
      },
      {
        "signal": "funding",
        "check": "funding field present",
        "weight": 0.05
      },
      {
        "signal": "repository_linked",
        "check": "repository field with valid URL",
        "weight": 0.1
      },
      {
        "signal": "recent_release",
        "check": "last publish < 365 days",
        "weight": 0.2
      },
      {
        "signal": "high_downloads",
        "check": "weekly downloads > 10000",
        "weight": 0.15
      }
    ],
    "negative": [
      {
        "signal": "no_readme",
        "check": "readme field is 'ERROR: No README data found!'",
        "weight": -0.2
      },
      {
        "signal": "single_maintainer",
        "check": "maintainers array length == 1",
        "weight": -0.1
      },
      {
        "signal": "no_repository",
        "check": "repository field missing",
        "weight": -0.15
      },
      {
        "signal": "minimal_package",
        "check": "dist.fileCount < 5",
        "weight": -0.1
      }
    ]
  },
  "version_resolution": {
    "semver_ranges": {
      "^": "Compatible with version (minor + patch)",
      "~": "Approximately equivalent (patch only)",
      ">": "Greater than specified version",
      ">=": "Greater than or equal to",
      "<": "Less than specified version",
      "<=": "Less than or equal to",
      "*": "Any version",
      "latest": "Latest published version"
    },
    "resolution_order": [
      "Check lockfile for exact version",
      "Resolve semver range from registry",
      "Apply peer dependency constraints",
      "Check for conflicts"
    ]
  },
  "common_patterns": {
    "transitive_attack": {
      "description": "Malicious package introduced via dependency chain",
      "detection": "Deep dependency tree analysis",
      "examples": ["event-stream incident", "ua-parser-js incident"]
    },
    "typosquatting": {
      "description": "Package with name similar to popular package",
      "detection": "Levenshtein distance from popular packages",
      "common_techniques": ["character swap", "missing hyphen", "extra character"]
    },
    "dependency_confusion": {
      "description": "Private package name registered publicly",
      "detection": "Check for packages matching internal naming patterns",
      "prevention": "Use scoped packages for internal code"
    }
  },
  "audit_commands": {
    "npm": {
      "audit": "npm audit",
      "audit_json": "npm audit --json",
      "audit_fix": "npm audit fix",
      "outdated": "npm outdated",
      "list_deps": "npm ls --all"
    },
    "yarn": {
      "audit": "yarn audit",
      "audit_json": "yarn audit --json",
      "outdated": "yarn outdated",
      "list_deps": "yarn list"
    },
    "pnpm": {
      "audit": "pnpm audit",
      "audit_json": "pnpm audit --json",
      "outdated": "pnpm outdated",
      "list_deps": "pnpm list"
    }
  }
}
