{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "GitHub Actions Patterns",
  "description": "Detection patterns for GitHub Actions optimization",
  "version": "1.0.0",
  "patterns": {
    "good_practices": {
      "dependency_caching": {
        "pattern": "actions/cache@v",
        "description": "Caching dependencies between runs",
        "configs": {
          "npm": {
            "path": "~/.npm",
            "key": "${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}"
          },
          "yarn": {
            "path": ".yarn/cache",
            "key": "${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}"
          },
          "pnpm": {
            "path": "~/.pnpm-store",
            "key": "${{ runner.os }}-pnpm-${{ hashFiles('**/pnpm-lock.yaml') }}"
          },
          "pip": {
            "path": "~/.cache/pip",
            "key": "${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}"
          }
        }
      },
      "matrix_builds": {
        "pattern": "strategy:\\s*matrix:",
        "description": "Parallel testing across configurations",
        "example": {
          "node-version": ["18.x", "20.x"],
          "os": ["ubuntu-latest", "windows-latest"]
        }
      },
      "concurrency_control": {
        "pattern": "concurrency:",
        "description": "Cancel redundant runs",
        "example": {
          "group": "${{ github.workflow }}-${{ github.ref }}",
          "cancel-in-progress": true
        }
      },
      "conditional_jobs": {
        "pattern": "if:\\s*\\$\\{\\{",
        "description": "Skip jobs based on conditions",
        "examples": [
          "if: github.event_name == 'push'",
          "if: contains(github.event.head_commit.message, '[skip ci]') == false"
        ]
      },
      "reusable_workflows": {
        "pattern": "workflow_call:",
        "description": "DRY workflow definitions"
      },
      "composite_actions": {
        "pattern": "using:\\s*composite",
        "description": "Reusable action steps"
      }
    },
    "anti_patterns": {
      "no_caching": {
        "pattern": "npm install|npm ci(?!.*cache)",
        "severity": "high",
        "description": "Installing dependencies without caching",
        "impact": "1-3 minutes per run",
        "recommendation": "Add actions/cache or use setup-node with cache option"
      },
      "full_checkout": {
        "pattern": "actions/checkout@(?!.*fetch-depth)",
        "severity": "medium",
        "description": "Fetching full git history",
        "impact": "10-60 seconds for large repos",
        "recommendation": "Add fetch-depth: 1 for shallow clone"
      },
      "sequential_jobs": {
        "pattern": "needs:\\s*\\[.*,.*,.*\\]",
        "severity": "medium",
        "description": "Long dependency chains",
        "recommendation": "Parallelize independent jobs"
      },
      "install_in_every_job": {
        "pattern": "npm install|npm ci.*\\n.*npm install|npm ci",
        "severity": "high",
        "description": "Reinstalling dependencies in every job",
        "recommendation": "Use artifacts or cache between jobs"
      },
      "hardcoded_versions": {
        "pattern": "node-version:\\s*['\"]?\\d+['\"]?",
        "severity": "low",
        "description": "Hardcoded runtime versions",
        "recommendation": "Use matrix or .nvmrc file"
      },
      "no_timeout": {
        "pattern": "jobs:\\s*\\w+:\\s*(?!timeout-minutes)",
        "severity": "medium",
        "description": "No job timeout set",
        "impact": "Stuck jobs can run for 6 hours",
        "recommendation": "Add timeout-minutes to all jobs"
      },
      "unnecessary_permissions": {
        "pattern": "permissions:\\s*write-all|contents:\\s*write",
        "severity": "high",
        "description": "Overly broad permissions",
        "recommendation": "Use least privilege, specify exact permissions"
      }
    }
  },
  "optimization_opportunities": {
    "test_splitting": {
      "description": "Split tests across parallel runners",
      "tools": ["jest --shard", "circleci tests split", "knapsack"]
    },
    "affected_only": {
      "description": "Run tests only for changed packages",
      "tools": ["nx affected", "turbo --filter", "lerna --since"]
    },
    "docker_layer_caching": {
      "description": "Cache Docker build layers",
      "approaches": ["docker/build-push-action with cache-from", "buildx cache"]
    },
    "artifact_sharing": {
      "description": "Share build outputs between jobs",
      "action": "actions/upload-artifact, actions/download-artifact"
    }
  },
  "cost_factors": {
    "runner_minutes": {
      "ubuntu": "1x multiplier",
      "macos": "10x multiplier",
      "windows": "2x multiplier"
    },
    "storage": {
      "artifacts": "Limited retention, counts against storage",
      "cache": "10GB per repo, 7-day unused eviction"
    }
  }
}
