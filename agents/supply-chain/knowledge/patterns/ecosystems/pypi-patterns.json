{
  "metadata": {
    "version": "1.0.0",
    "updated": "2025-01-15",
    "category": "supply-chain/ecosystems",
    "description": "PyPI ecosystem patterns for package analysis and security assessment"
  },
  "ecosystem": {
    "name": "PyPI",
    "registry": "https://pypi.org",
    "package_managers": ["pip", "poetry", "pipenv", "conda", "uv"],
    "manifest_files": [
      "requirements.txt",
      "setup.py",
      "setup.cfg",
      "pyproject.toml",
      "Pipfile",
      "environment.yml"
    ],
    "lockfiles": ["Pipfile.lock", "poetry.lock", "requirements.lock", "uv.lock"]
  },
  "api_endpoints": {
    "package_info": "https://pypi.org/pypi/{package}/json",
    "package_version": "https://pypi.org/pypi/{package}/{version}/json",
    "simple_index": "https://pypi.org/simple/{package}/",
    "search": "https://pypi.org/search/?q={query}",
    "stats": "https://pypistats.org/api/packages/{package}/recent"
  },
  "package_name_validation": {
    "pattern": "^([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9._-]*[A-Za-z0-9])$",
    "normalization": "lowercase, replace [-_.] with -",
    "max_length": 100,
    "case_insensitive": true,
    "note": "PyPI normalizes names: Django, django, DJANGO are the same"
  },
  "security_indicators": {
    "yanked": {
      "field": "yanked",
      "severity": "high",
      "description": "Version was yanked (usually due to security issue or bug)"
    },
    "no_source_dist": {
      "indicator": "Only wheel available, no sdist",
      "severity": "info",
      "description": "Cannot inspect source code easily"
    },
    "suspicious_classifiers": {
      "patterns": ["Development Status :: 1 - Planning"],
      "severity": "low",
      "description": "Package may not be production-ready"
    },
    "install_scripts": {
      "files": ["setup.py with arbitrary code"],
      "severity": "medium",
      "description": "Package runs arbitrary Python during installation"
    }
  },
  "health_signals": {
    "positive": [
      {
        "signal": "project_urls",
        "check": "info.project_urls contains 'Source' or 'Repository'",
        "weight": 0.1
      },
      {
        "signal": "verified_publisher",
        "check": "Trusted publisher (GitHub Actions publishing)",
        "weight": 0.15
      },
      {
        "signal": "type_hints",
        "check": "py.typed marker or inline stubs",
        "weight": 0.1
      },
      {
        "signal": "recent_release",
        "check": "Last release < 365 days",
        "weight": 0.2
      },
      {
        "signal": "multiple_maintainers",
        "check": "More than one maintainer listed",
        "weight": 0.1
      }
    ],
    "negative": [
      {
        "signal": "no_description",
        "check": "info.summary is empty",
        "weight": -0.2
      },
      {
        "signal": "no_homepage",
        "check": "info.home_page is null",
        "weight": -0.1
      },
      {
        "signal": "no_license",
        "check": "info.license is null or 'UNKNOWN'",
        "weight": -0.15
      },
      {
        "signal": "single_release",
        "check": "Only one version ever released",
        "weight": -0.1
      }
    ]
  },
  "version_resolution": {
    "pep440_specifiers": {
      "==": "Exact version match",
      "!=": "Exclude specific version",
      ">=": "Minimum version (inclusive)",
      ">": "Minimum version (exclusive)",
      "<=": "Maximum version (inclusive)",
      "<": "Maximum version (exclusive)",
      "~=": "Compatible release (same major.minor)",
      "===": "Arbitrary equality (string match)"
    },
    "environment_markers": {
      "python_version": "Python version constraint",
      "sys_platform": "Platform constraint (linux, darwin, win32)",
      "extra": "Optional dependency group"
    },
    "resolution_order": [
      "Check lockfile for pinned versions",
      "Parse requirements specifiers",
      "Resolve compatible versions from index",
      "Apply environment markers",
      "Check for conflicts"
    ]
  },
  "common_patterns": {
    "namespace_package_attack": {
      "description": "Malicious package using same namespace as trusted package",
      "detection": "Check for packages in same namespace with different maintainers",
      "examples": ["Various google.* and azure.* namespace attacks"]
    },
    "typosquatting": {
      "description": "Package with name similar to popular package",
      "detection": "Levenshtein distance, common misspellings",
      "common_techniques": ["character swap", "missing hyphen", "homoglyph"]
    },
    "install_time_attack": {
      "description": "Malicious code in setup.py executed during install",
      "detection": "Static analysis of setup.py",
      "prevention": "Use --no-build-isolation with caution"
    }
  },
  "audit_commands": {
    "pip": {
      "check": "pip check",
      "list": "pip list",
      "list_outdated": "pip list --outdated",
      "freeze": "pip freeze"
    },
    "pip_audit": {
      "audit": "pip-audit",
      "audit_json": "pip-audit --format json",
      "audit_fix": "pip-audit --fix"
    },
    "safety": {
      "check": "safety check",
      "check_json": "safety check --json"
    },
    "poetry": {
      "show": "poetry show",
      "show_outdated": "poetry show --outdated",
      "check": "poetry check"
    }
  },
  "trusted_namespaces": {
    "description": "Well-known namespace packages from trusted publishers",
    "examples": [
      "google.*",
      "azure.*",
      "aws.*",
      "boto3.*",
      "django.*",
      "flask.*"
    ]
  }
}
