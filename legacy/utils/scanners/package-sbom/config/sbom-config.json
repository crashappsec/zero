{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "$id": "https://crashoverride.com/schemas/sbom-config.json",
  "title": "SBOM Generation Configuration",
  "description": "Comprehensive configuration for Software Bill of Materials (SBOM) generation",

  "sbom": {
    "format": "cyclonedx-json",
    "use_lock_files": true,
    "include_dev_deps": false,
    "include_test_deps": false,
    "scan_node_modules": false,
    "resolve_versions": true,
    "output_dir": "sbom-output",

    "formats": {
      "_comment": "Available SBOM formats",
      "supported": [
        "cyclonedx-json",
        "cyclonedx-xml",
        "spdx-json",
        "spdx-tag-value",
        "syft-json",
        "table"
      ],
      "recommended": "cyclonedx-json",
      "compliance": {
        "cisa_ntia": ["cyclonedx-json", "spdx-json"],
        "openssf": ["cyclonedx-json", "spdx-json"]
      }
    },

    "lock_files": {
      "_comment": "Lock file usage configuration for accurate dependency resolution",
      "enabled": true,
      "fallback_to_manifest": true,
      "validate_after_generation": true,

      "package_managers": {
        "npm": {
          "lock_file": "package-lock.json",
          "manifest": "package.json",
          "cataloger": "javascript-lock",
          "prefer_lock": true,
          "include_workspaces": true
        },
        "yarn": {
          "lock_file": "yarn.lock",
          "manifest": "package.json",
          "cataloger": "javascript-lock",
          "prefer_lock": true,
          "version_detection": "v1_or_v2_auto"
        },
        "pnpm": {
          "lock_file": "pnpm-lock.yaml",
          "manifest": "package.json",
          "cataloger": "javascript-lock",
          "prefer_lock": true,
          "virtual_store_handling": true
        },
        "bun": {
          "lock_file": "bun.lockb",
          "manifest": "package.json",
          "cataloger": "javascript-lock",
          "prefer_lock": true
        },
        "pip": {
          "lock_file": "requirements.txt",
          "manifest": "pyproject.toml",
          "cataloger": "python-package",
          "prefer_lock": false
        },
        "poetry": {
          "lock_file": "poetry.lock",
          "manifest": "pyproject.toml",
          "cataloger": "python-lock",
          "prefer_lock": true,
          "include_groups": ["main"]
        },
        "pipenv": {
          "lock_file": "Pipfile.lock",
          "manifest": "Pipfile",
          "cataloger": "python-lock",
          "prefer_lock": true
        },
        "cargo": {
          "lock_file": "Cargo.lock",
          "manifest": "Cargo.toml",
          "cataloger": "rust-cargo-lock",
          "prefer_lock": true
        },
        "go": {
          "lock_file": "go.sum",
          "manifest": "go.mod",
          "cataloger": "go-module-binary,go-mod-file",
          "prefer_lock": true
        },
        "bundler": {
          "lock_file": "Gemfile.lock",
          "manifest": "Gemfile",
          "cataloger": "ruby-gemfile-lock",
          "prefer_lock": true
        },
        "maven": {
          "lock_file": null,
          "manifest": "pom.xml",
          "cataloger": "java-pom",
          "prefer_lock": false,
          "effective_pom": true
        },
        "gradle": {
          "lock_file": "gradle.lockfile",
          "manifest": "build.gradle",
          "cataloger": "java-gradle",
          "prefer_lock": true,
          "dependency_locking": "recommended"
        },
        "composer": {
          "lock_file": "composer.lock",
          "manifest": "composer.json",
          "cataloger": "php-composer-lock",
          "prefer_lock": true
        }
      }
    },

    "dependencies": {
      "_comment": "Dependency inclusion/exclusion configuration",

      "production": {
        "include": true,
        "transitive": true,
        "description": "Production runtime dependencies"
      },

      "development": {
        "include": false,
        "transitive": false,
        "description": "Development-only dependencies (eslint, prettier, etc.)",
        "patterns": [
          "devDependencies",
          "dev-dependencies",
          "**/test/**",
          "**/tests/**",
          "**/__tests__/**",
          "**/spec/**"
        ]
      },

      "test": {
        "include": false,
        "transitive": false,
        "description": "Test framework and testing dependencies",
        "patterns": [
          "**/test/**",
          "**/tests/**",
          "**/__tests__/**",
          "**/spec/**",
          "**/fixtures/**",
          "**/mocks/**"
        ]
      },

      "optional": {
        "include": true,
        "description": "Optional dependencies that may not be installed"
      },

      "peer": {
        "include": true,
        "description": "Peer dependencies required by the package"
      }
    },

    "scanning": {
      "_comment": "File and directory scanning configuration",

      "node_modules": {
        "scan": false,
        "reason": "Prefer lock file for accuracy; node_modules may have cached or hoisted versions",
        "scan_if_no_lock": true,
        "exclude_patterns": [
          "node_modules/.cache",
          "node_modules/.bin"
        ]
      },

      "vendor": {
        "scan": false,
        "reason": "Vendor directories typically duplicate lock file information"
      },

      "include_paths": [
        ".",
        "packages/*",
        "apps/*"
      ],

      "exclude_paths": [
        "node_modules",
        ".git",
        "dist",
        "build",
        "coverage",
        "tmp",
        "temp",
        ".cache"
      ]
    },

    "version_resolution": {
      "_comment": "Version range and resolution configuration",

      "enabled": true,
      "strategy": "lock_file_first",
      "pin_versions": true,

      "range_handling": {
        "_comment": "How to handle version ranges like ^1.2.3 or ~2.0.0",
        "resolve_to_exact": true,
        "source": "lock_file",
        "fallback": "latest_matching"
      },

      "transitive_deps": {
        "include": true,
        "max_depth": -1,
        "description": "Include all transitive dependencies (-1 = unlimited depth)"
      },

      "deduplication": {
        "enabled": true,
        "strategy": "semver",
        "description": "Deduplicate packages with same name and version"
      }
    },

    "metadata": {
      "_comment": "SBOM metadata and component information",

      "include_licenses": true,
      "include_checksums": true,
      "include_purls": true,
      "include_cpes": false,

      "checksum_algorithms": [
        "sha256",
        "sha1"
      ],

      "component_metadata": {
        "supplier": true,
        "author": true,
        "description": true,
        "homepage": true,
        "repository": true,
        "download_location": true
      }
    },

    "validation": {
      "_comment": "SBOM validation and quality checks",

      "enabled": true,
      "strict_mode": false,

      "checks": {
        "minimum_elements": true,
        "cisa_ntia_compliance": true,
        "license_presence": true,
        "checksum_presence": true,
        "purl_format": true,
        "lock_file_consistency": true
      },

      "cisa_ntia_minimum": {
        "_comment": "CISA NTIA minimum elements for SBOM (2025)",
        "required_fields": [
          "supplier_name",
          "component_name",
          "version_of_component",
          "other_unique_identifiers",
          "dependency_relationship",
          "author_of_sbom_data",
          "timestamp"
        ]
      }
    },

    "output": {
      "_comment": "Output file configuration",

      "directory": "sbom-output",
      "filename_pattern": "{repo}-{timestamp}.{format}",
      "create_directory": true,
      "overwrite_existing": false,

      "compression": {
        "enabled": false,
        "format": "gzip"
      },

      "signing": {
        "enabled": false,
        "tool": "cosign",
        "keyless": true
      }
    },

    "performance": {
      "_comment": "Performance and caching configuration",

      "cache": {
        "enabled": true,
        "directory": ".sbom-cache",
        "ttl_hours": 24,
        "cache_metadata": true
      },

      "parallel": {
        "enabled": true,
        "max_workers": 4
      },

      "timeout": {
        "generation": 600,
        "api_calls": 30
      }
    },

    "integrations": {
      "_comment": "Third-party service integrations",

      "deps_dev": {
        "enabled": true,
        "api_base_url": "https://api.deps.dev/v3alpha",
        "timeout": 30,
        "retry_attempts": 3,
        "enrich_metadata": true
      },

      "osv": {
        "enabled": false,
        "vulnerability_check": false
      },

      "vex": {
        "enabled": false,
        "generate_vex_alongside": false
      }
    }
  },

  "presets": {
    "_comment": "Pre-configured profiles for common use cases",

    "production": {
      "description": "Production SBOM with only runtime dependencies",
      "format": "cyclonedx-json",
      "use_lock_files": true,
      "include_dev_deps": false,
      "include_test_deps": false,
      "scan_node_modules": false,
      "resolve_versions": true
    },

    "compliance": {
      "description": "CISA NTIA compliant SBOM with full metadata",
      "format": "spdx-json",
      "use_lock_files": true,
      "include_dev_deps": false,
      "include_test_deps": false,
      "metadata": {
        "include_licenses": true,
        "include_checksums": true,
        "include_purls": true
      },
      "validation": {
        "cisa_ntia_compliance": true
      }
    },

    "development": {
      "description": "Full SBOM including dev and test dependencies",
      "format": "cyclonedx-json",
      "use_lock_files": true,
      "include_dev_deps": true,
      "include_test_deps": true,
      "scan_node_modules": false
    },

    "security_audit": {
      "description": "SBOM optimized for security analysis",
      "format": "cyclonedx-json",
      "use_lock_files": true,
      "include_dev_deps": true,
      "include_test_deps": true,
      "metadata": {
        "include_licenses": true,
        "include_checksums": true,
        "include_cpes": true
      },
      "integrations": {
        "osv": {
          "vulnerability_check": true
        }
      }
    }
  },

  "examples": {
    "_comment": "Example configurations for different scenarios",

    "monorepo": {
      "description": "Configuration for monorepo with multiple packages",
      "scanning": {
        "include_paths": [
          "packages/*",
          "apps/*"
        ]
      },
      "lock_files": {
        "package_managers": {
          "npm": {
            "include_workspaces": true
          }
        }
      }
    },

    "minimal": {
      "description": "Minimal SBOM for quick generation",
      "format": "table",
      "use_lock_files": false,
      "metadata": {
        "include_licenses": false,
        "include_checksums": false
      }
    },

    "signed": {
      "description": "Signed SBOM with attestation",
      "output": {
        "signing": {
          "enabled": true,
          "tool": "cosign",
          "keyless": true
        }
      }
    }
  }
}
